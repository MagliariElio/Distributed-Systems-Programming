package logic.dao;

import org.bson.BsonDocument;
import org.bson.BsonInt64;
import org.bson.Document;
import org.bson.conversions.Bson;

import com.mongodb.MongoException;
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoDatabase;

public class Database {
	private static Database instance;
	private String URI = "mongodb://annunci:annunci@localhost:27017";
	private String nameDatabase = "CiociariaAnnunci";
	private MongoDatabase connection;
	
	private Database() {
		try(MongoClient mongoClient = MongoClients.create(URI)) {
			MongoDatabase connection = mongoClient.getDatabase(nameDatabase);
			try {
				Bson command = new BsonDocument("ping", new BsonInt64(1));
				Document commandResult = connection.runCommand(command);
				System.out.println("Successful connection with the database: " + connection.getName() + " " + connection.toString());
				for(String collection: connection.listCollectionNames()) {}
				System.out.println(connection.listCollectionNames());
			} catch(MongoException me) {
				System.out.println(me.getMessage());
			}
		}
	}
	
	public static Database getInstance() {
		if (instance == null) {
			instance = new Database();
		}
		return instance;
	}
	
	public MongoDatabase getConnection() {
		return connection;
	}

}
